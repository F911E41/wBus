# Vision: The wBus Frontend

[![Next.js](https://img.shields.io/badge/Next.js-16-black?logo=next.js)](https://nextjs.org/)
[![React](https://img.shields.io/badge/React-19-blue?logo=react)](https://react.dev/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-blue?logo=typescript)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind%20CSS-4-38B2AC?logo=tailwind-css)](https://tailwindcss.com/)

Vision is the user-facing frontend for the `wBus` project. Built with Next.js and React, it provides a real-time,
interactive map to visualize bus locations and schedules for Wonju, South Korea.

## Core Features

- **Live Bus Tracking**: Displays animated bus markers on an interactive map, updating their positions in real-time.
- **Interactive Map**: Uses MapLibre for the base layer and React-Leaflet for overlays, providing a smooth, fast map
  experience.
- **Route & Schedule Display**: Allows users to select specific bus routes, view their paths, and see detailed
  schedules.
- **Persistent State**: Remembers the user's last selected route and map view across sessions using `localStorage`.
- **Responsive Design**: A mobile-first interface that works great on any screen size.
- **Efficient Data Fetching**: Utilizes a smart polling service for live data and leverages Next.js for optimized
  loading of static data.

## Tech Stack

- **Framework**: [Next.js](https://nextjs.org/) 16 (with App Router)
- **UI Library**: [React](https://react.dev/) 19
- **Language**: [TypeScript](https://www.typescriptlang.org/)
- **Styling**: [Tailwind CSS](https://tailwindcss.com/) 4
- **Mapping**:
  - [React-Leaflet](https://react-leaflet.js.org/) for React integration.
  - [MapLibre GL JS](https://maplibre.org/) for rendering map tiles.
  - [Leaflet.RotatedMarker](https://github.com/bbecquet/Leaflet.RotatedMarker) for bus direction.
  - `leaflet.marker.slideto` for smooth marker animations.
- **Linting/Formatting**: ESLint

## Getting Started

Follow these steps to get the development environment running on your local machine.

1. **Clone the repository and navigate into the `Vision` directory:**

    ```bash
    # Make sure you are in the root of the wBus project
    cd Vision
    ```

2. **Install dependencies using npm:**

    ```bash
    npm install
    ```

3. **Set up environment variables:**

   Create a `.env.local` file in the `Vision` directory by copying the example file:

    ```bash
    cp .env.local.example .env.local
    ```

   Now, open `.env.local` and fill in the required variables. At a minimum, you need to set the URL for the live data
   API.

    ```dotenv
    # .env.local

    # Required: The base URL for the real-time bus data API.
    # In development, you can use the proxy by setting REMOTE_API_URL.
    NEXT_PUBLIC_LIVE_API_URL="/dev"
    REMOTE_API_URL="https://your-actual-api-gateway-url.com"

    # Optional: Set to true if you are hosting the static data (from Polly) on a remote server/CDN.
    NEXT_PUBLIC_USE_REMOTE_STATIC_DATA=false
    # If the above is true, provide the base URL for the remote static data.
    # NEXT_PUBLIC_STATIC_API_URL="https://your-cdn.com/data"
    ```

   *See the **Configuration** section below for more details.*

4. **Run the development server:**

   The project is configured to use Next.js's Turbopack for a fast development experience.

    ```bash
    npm run dev
    ```

   Open [http://localhost:3000](http://localhost:3000) in your browser to see the application.

## Data Flow

Vision consumes two types of data:

1. **Static Data**: This includes route paths, stop locations, and bus schedules. It is generated by the sister project,
   **Polly**. This data can be served in two ways:
    - **Locally**: During development, you can place the output from Polly into the `Vision/public/data` directory.
    - **Remotely**: In production, this data can be uploaded to an S3 bucket or similar object store and served via a
      CDN. Set `NEXT_PUBLIC_USE_REMOTE_STATIC_DATA=true` and provide the `NEXT_PUBLIC_STATIC_API_URL` to enable this.

2. **Live Data**: This includes real-time bus locations and arrival estimates. It is fetched from a live API endpoint (
   e.g., an AWS API Gateway). The URL for this API is configured via `NEXT_PUBLIC_LIVE_API_URL`.

## Configuration

The application is configured using environment variables in `.env.local`.

### Core

- `NEXT_PUBLIC_LIVE_API_URL`: **(Required)** The endpoint for real-time bus data.
- `NEXT_PUBLIC_USE_REMOTE_STATIC_DATA`: `true` or `false`. Determines whether to load static assets from a remote URL or
  from the local `/public` directory.
- `NEXT_PUBLIC_STATIC_API_URL`: The base URL for remote static assets.

### Map Behavior

- `NEXT_PUBLIC_MAP_DEFAULT_POSITION`: Default `lat,lng` for the map's center.
- `NEXT_PUBLIC_MAP_DEFAULT_ZOOM`: Default zoom level.
- `NEXT_PUBLIC_BUS_STOP_MARKER_MIN_ZOOM`: Zoom level at which bus stop markers become visible.

### Development

- `REMOTE_API_URL`: Used by the Next.js development server to proxy requests from `/dev` to the actual live API,
  avoiding CORS issues.

## Available Scripts

- `npm run dev`: Starts the development server with Turbopack.
- `npm run build`: Creates a production-ready build of the application.
- `npm run start`: Starts the application in production mode (requires `npm run build` first).
- `npm run lint`: Runs ESLint to check for code quality and style issues.

## Project Structure

The `src` directory is organized by feature and domain to keep the codebase modular and maintainable.

```zsh
src/
├── app/            # Next.js App Router: pages, layouts, and global styles.
├── core/           # Core application logic: config, domain models, network clients.
├── features/       # Feature-based modules (bus, map, schedule).
│   ├── bus/        # Everything related to buses: components, hooks, services.
│   ├── map/        # Map components, context, and utilities.
│   └── schedule/   # Schedule-related UI and data hooks.
└── shared/         # Shared components and utilities used across features.
    ├── ui/         # Reusable, generic UI components (e.g., NavBar, Splash screen).
    └── utils/      # General utility functions.
```
